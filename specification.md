# NDNCERT Capstone Specification

## 1. Introduction
The NDN testbed consists of multiple nodes, which are used to announce prefixes. Additionally, some nodes can be added to the testbed as routers. When a new testbed node is added, in order for it to announce prefixes, it needs to be authenticated and issued an NDN certificate. Currently the NDNCERT protocol is used for issuing certificates. This is a manual process that requires human authentication of the testbed nodes and issuance of certificates to the nodes. Additionally, in the case of a key getting compromised, the certificate has to be manually revoked and the node has to be issued a new one. This process is a reactive approach to security rather than a preventative approach of frequently rotating the certificates to avoid the issue of key compromise.

## 2. Proposal
This project proposes an automated version of the NDNCERT protocol in which the certificate authority will be contacted by the testbed node (client), then authenticate the client through some challenge response, receive a certificate signing request (CSR) from client, and issue the certificate. The certificates will be generated with a specified lifetime so that clients must be issued new certificates frequently to prevent the issue of a compromised key.

This protocol uses proof of possession to ensure the client owns the private key corresponding to the public key signed in their x.509 certificate. This protocol assumes that the client has the CA installed in its list of trusted CAs, has generated a key value pair, and already possesses an x.509 certificate. The client then selects the CA and contacts the CA to receive the ownership challenge. The CA issues a random number (nonce), which the client then signs using its private key. This allows the CA to verify the client’s ownership of the private key. Along with the signed nonce, the client also creates a CSR to request a certificate from the CA. This CSR is signed with the client’s private key so the CA can verify the request. The CA then creates a certificate with the public key of the client and issues the certificate to the client.

Additionally, since there are some testbed nodes that have permission to act as routers in the testbed, there need to be certificates specific for these clients. These router nodes are specified on an access control list (ACL). This protocol will utilize another CA under the /router prefix which will authorize these specific clients using the ACL and issue them router certificates.

## 3. Specification

### 3.1 CA Profile (From [NDNCERT Protocol 0.3](https://github.com/named-data/ndncert/wiki/NDNCERT-Protocol-0.3))
#### 3.1.1 Specification
The CA profile specifies a CA's requirements on name assignment, the CA's certificate, and other information. It is published as a segmented object (one or more Data packets) following the NDN naming conventions.

Every requester needs to obtain the CA profile before applying for, renewing, or revoking certificates. It is assumed that a requester should already have certain means to authenticate a CA's profile. For example, the requester can obtain the CA's public key in advance through out-of-band channels, so that it can use the public key to verify that the CA profile Data packets are generated by the expected CA.

It is also possible to design an identity verification challenge to be bidirectional (the CA and the requester verifies each other's identity). In this case, the requester can provisionally accept the CA profile and verify the CA's identity in a later step. For example, the challenge can require proof of knowledge of a shared secret that is only known to the CA and the requester.

The CA profile is versioned and segmented, and can be fetched using the [NDN RDR protocol](https://redmine.named-data.net/projects/ndn-tlv/wiki/RDR). It can be considered static content and can thus be hosted by an NDN repository.

#### 3.1.2 Packet Format
Data format:
| Field      | Description |
|------:|:------------|
| Name      | ``` /<CA-Prefix>/CA/INFO/<version>/<segment> ```     |
| Content   | See below        |
| Signature | Signed by the CA's identity key |

``` abnf
Content = CONTENT-TYPE TLV-LENGTH
          ca-prefix
          ca-info
          *parameter-key
          max-validity-period
          ca-certificate
ca-prefix = CA-PREFIX-TYPE TLV-LENGTH Name
ca-info = CA-INFO-TYPE TLV-LENGTH *OCTET
parameter-key = PARAMETER-KEY-TYPE TLV-LENGTH *OCTET
max-validity-period = MAX-VALIDITY-PERIOD-TYPE TLV-LENGTH NonNegativeInteger
ca-certificate = CA-CERTIFICATE-TYPE TLV-LENGTH CertificateV2
```

* ``` ca-prefix ```, bytes value, the TLV of NDN name of the CA. This name should be reachable to requesters. Note that the component CA is added by the NDNCERT protocol. Therefore, there is no need to include CA in the ca-prefix in the configuration file nor in the key name.
* ``` ca-info ```, UTF-8 string value, a brief human-readable description of the CA.
* A number of parameter-key, UTF-8 string value, a list of attributes required by the CA to identify the name for a requester in the PROBE step.
* ``` max-validity-period ```, non negative integer value, maximum allowed validity period of the desired certificate in seconds.
* ``` ca-certificate ```, bytes value, TLV of the CA's certificate.

### 3.2 Proof of Possession
#### 3.2.1 Specification
In oder to issue an NDN Cert to the client requestion, it needs to be verified that the client actually possesses the private key corresponding to the public key the certificate authority is signing. Proof of possession is used in order to verify a client's ownership of the private key.

Once the client selects the CA and the CA profile is obtained, the client will request the proof of possession (PoP) challenge from the CA. This will be sent in the interest packet.

Once the CA receieves the PoP request, the CA will generate a random number (nonce) and send this to the client in the data packet.

#### 3.2.2 Packet Format

Interest format:

| Field      | Description |
|------:|:------------|
| Name      | ``` /<CA-Prefix>/CA/?? ```     |
| Content   | See below        |
| Signature | Not required |

``` abnf
Content = CONTENT-TYPE TLV-LENGTH
          pop-request
pop-request = POP-REQUEST-TYPE TLV-LENGTH *OCTET
```
* `pop-request`, bytes value, the TLV of a signed nonce generated by the requester.

Data format:

| Field | Description |
|------:|:------------|
| Name | `/<CA-prefix>/CA/??` |
| FreshnessPeriod | 4 seconds |
| Content | See below |
| Signature | Signed by the CA's identity key |

```abnf
Content = CONTENT-TYPE TLV-LENGTH
          request-id
          challenge
request-id = REQUEST-ID-TYPE
             TLV-LENGTH ; == 8
             8OCTET
nonce = NONCE-TYPE
            TLV-LENGTH ; == 8
            8OCTET
```

* `request-id`, 8 bytes value, unique ID assignment for this request instance.
* `challenge`, 8 bytes value, random number the requester signs to demonstrate proof of possession.

### 3.3 Certificate Request

#### 3.3.1 Specification

#### 3.3.2 Packet Format
* `cert-request`, bytes value, the TLV of a self-signed certificate generated by the requester. It should follow the [NDN certificate format](https://named-data.net/doc/ndn-cxx/0.7.0/specs/certificate-format.html).
